@model BerberOto.Models.Shop
@{
    ViewData["Title"] = Model.Name;
}

<!-- SHOP HERO -->
<section class="hero-section" style="min-height:60vh;">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <div class="hero-content">
                    <div class="hero-badge">
                        <i class="fa-solid fa-store"></i> @Model.Name
                    </div>
                    <h1 class="hero-title">
                        @Model.Name<br />
                        <span class="gradient-text">Berber Salonu</span>
                    </h1>
                    <p class="hero-description">@Model.Description</p>
                    <div class="hero-buttons">
                        <a href="/salon/@Model.Slug/randevu" class="btn-accent">
                            <i class="fa-solid fa-calendar-check"></i> Randevu Al
                        </a>
                        <a href="/salon/@Model.Slug/qr" class="btn-outline-accent">
                            <i class="fa-solid fa-qrcode"></i> QR Kod
                        </a>
                        <a href="#yorumlar" class="btn-outline-accent">
                            <i class="fa-solid fa-star"></i> Yorumlar
                        </a>
                        <a href="/salon/@Model.Slug/admin" class="btn-outline-accent">
                            <i class="fa-solid fa-lock"></i> Yönetim
                        </a>
                    </div>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <span class="stat-number">@Model.Barbers.Count</span>
                            <div class="stat-label">Uzman Berber</div>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">@Model.Services.Count</span>
                            <div class="stat-label">Hizmet</div>
                        </div>
                        @if (!string.IsNullOrEmpty(Model.City))
                        {
                            <div class="stat-item">
                                <span class="stat-number"><i class="fa-solid fa-location-dot" style="font-size:0.8em;"></i></span>
                                <div class="stat-label">@Model.City</div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="col-lg-5 d-none d-lg-flex justify-content-center">
                <div style="width:300px; height:350px; border-radius:var(--radius-xl); background:var(--gradient-card); border:1px solid var(--border-glass); display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden;">
                    <div style="text-align:center;">
                        <div style="width:120px; height:120px; border-radius:50%; background:linear-gradient(135deg, var(--accent), var(--accent-hover)); display:flex; align-items:center; justify-content:center; margin:0 auto 1rem;">
                            <span style="font-size:2.5rem; font-weight:700; color:#1a1a2e;">@Model.Name.Substring(0, Math.Min(2, Model.Name.Length)).ToUpper()</span>
                        </div>
                        <p style="color:var(--accent); font-family:var(--font-heading); font-size:1.2rem;">@Model.Name</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- SERVICES -->
<section class="section" id="hizmetler">
    <div class="container">
        <div class="text-center">
            <div class="section-divider"></div>
            <h2 class="section-title reveal">Hizmetlerimiz</h2>
            <p class="section-subtitle reveal">Sunduğumuz profesyonel hizmetler</p>
        </div>
        <div class="row g-4">
            @foreach (var service in Model.Services)
            {
                <div class="col-lg-4 col-md-6">
                    <div class="service-card reveal">
                        <div class="service-icon">
                            <i class="fa-solid @service.Icon"></i>
                        </div>
                        <h4>@service.Name</h4>
                        <p>@service.Description</p>
                        <div class="service-meta">
                            <span class="service-price">@service.Price.ToString("N0") ₺</span>
                            <span class="service-duration">
                                <i class="fa-regular fa-clock"></i> @service.DurationMinutes dk
                            </span>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- TEAM -->
<section class="section section-dark" id="ekip">
    <div class="container">
        <div class="text-center">
            <div class="section-divider"></div>
            <h2 class="section-title reveal">Ekibimiz</h2>
            <p class="section-subtitle reveal">Uzman berberlerimizle tanışın</p>
        </div>
        <div class="row g-4 justify-content-center">
            @foreach (var barber in Model.Barbers)
            {
                <div class="col-lg-4 col-md-6">
                    <div class="team-card reveal">
                        <div class="team-avatar">
                            @barber.FullName.Substring(0, Math.Min(2, barber.FullName.Length)).ToUpper()
                        </div>
                        <div class="team-info">
                            <h4>@barber.FullName</h4>
                            <div class="team-title">@barber.Title</div>
                            <p>@barber.Bio</p>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</section>

<!-- WORKING HOURS -->
@if (Model.WorkSchedules.Any())
{
    var dayNames = new Dictionary<DayOfWeek, string>
    {
        { DayOfWeek.Monday, "Pazartesi" },
        { DayOfWeek.Tuesday, "Salı" },
        { DayOfWeek.Wednesday, "Çarşamba" },
        { DayOfWeek.Thursday, "Perşembe" },
        { DayOfWeek.Friday, "Cuma" },
        { DayOfWeek.Saturday, "Cumartesi" },
        { DayOfWeek.Sunday, "Pazar" }
    };
    var orderedSchedules = Model.WorkSchedules
        .OrderBy(w => w.DayOfWeek == DayOfWeek.Sunday ? 7 : (int)w.DayOfWeek)
        .ToList();
    var today = DateTime.Now.DayOfWeek;

    <section class="section" id="saatler">
        <div class="container">
            <div class="text-center">
                <div class="section-divider"></div>
                <h2 class="section-title reveal">Çalışma Saatleri</h2>
                <p class="section-subtitle reveal">Sizi ne zaman ağırlayabileceğimizi görün</p>
            </div>
            <div class="row justify-content-center">
                <div class="col-lg-6">
                    <div class="schedule-list reveal">
                        @foreach (var s in orderedSchedules)
                        {
                            var isToday = s.DayOfWeek == today;
                            <div class="schedule-item @(isToday ? "schedule-today" : "") @(s.IsClosed ? "schedule-closed" : "")">
                                <span class="schedule-day">
                                    @if (isToday) { <i class="fa-solid fa-circle" style="font-size:0.5rem; color:#D4A574; vertical-align:middle; margin-right:0.3rem;"></i> }
                                    @dayNames[s.DayOfWeek]
                                </span>
                                <span class="schedule-time">
                                    @if (s.IsClosed)
                                    {
                                        <span style="color:#ff6b7a;">Kapalı</span>
                                    }
                                    else
                                    {
                                        @s.OpenTime<text> - </text>@s.CloseTime
                                    }
                                </span>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    </section>
}

<!-- REVIEWS -->
<section class="section" id="yorumlar">
    <div class="container">
        <div class="text-center">
            <div class="section-divider"></div>
            <h2 class="section-title reveal">Müşteri Yorumları</h2>
            @{
                var avg = Model.Reviews.Any() ? Model.Reviews.Average(r => r.Rating) : 0.0;
                var avgRounded = Math.Round(avg, 1);
            }
            @if (Model.Reviews.Any())
            {
                <div style="margin-bottom:1rem;">
                    <span style="font-size:2rem; font-weight:700; color:var(--accent); font-family:var(--font-heading);">@avgRounded</span>
                    <span style="color:var(--text-muted); font-size:0.9rem;"> / 5</span>
                    <div style="margin-top: 0.3rem;">
                        @for (int i = 1; i <= 5; i++)
                        {
                            if (i <= Math.Floor(avg))
                            {
                                <i class="fa-solid fa-star" style="color:#FFD700; font-size:1.1rem;"></i>
                            }
                            else if (i - avg < 1 && i - avg > 0)
                            {
                                <i class="fa-solid fa-star-half-stroke" style="color:#FFD700; font-size:1.1rem;"></i>
                            }
                            else
                            {
                                <i class="fa-regular fa-star" style="color:#FFD700; font-size:1.1rem;"></i>
                            }
                        }
                        <span style="color:var(--text-muted); font-size:0.85rem; margin-left:0.5rem;">(@Model.Reviews.Count yorum)</span>
                    </div>
                </div>
            }
            else
            {
                <p class="section-subtitle reveal">Henüz yorum yok. İlk yorumu siz yapın!</p>
            }
        </div>

        <!-- Review Cards -->
        @if (Model.Reviews.Any())
        {
            <div class="row g-4 mb-5">
                @foreach (var review in Model.Reviews.Take(6))
                {
                    <div class="col-lg-4 col-md-6">
                        <div class="review-card reveal">
                            <div class="review-header">
                                <div class="review-avatar">
                                    @review.CustomerName.Substring(0, Math.Min(1, review.CustomerName.Length)).ToUpper()
                                </div>
                                <div>
                                    <div class="review-name">@review.CustomerName</div>
                                    <div class="review-date">@review.CreatedAt.ToString("dd MMM yyyy", new System.Globalization.CultureInfo("tr-TR"))</div>
                                </div>
                            </div>
                            <div class="review-stars">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fa-solid fa-star" style="color:@(i <= review.Rating ? "#FFD700" : "rgba(255,255,255,0.1)"); font-size:0.85rem;"></i>
                                }
                            </div>
                            <p class="review-comment">@review.Comment</p>
                        </div>
                    </div>
                }
            </div>
        }

        <!-- Review Form -->
        <div class="review-form-wrapper reveal">
            <h3 style="font-family:var(--font-body); font-size:1.3rem; font-weight:600; margin-bottom:1.5rem; text-align:center;">
                <i class="fa-solid fa-pen" style="color:var(--accent);"></i> Yorum Bırakın
            </h3>
            <form action="/salon/@Model.Slug/yorum" method="post" id="reviewForm">
                @Html.AntiForgeryToken()

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label class="form-label-custom">Adınız *</label>
                        <input type="text" name="CustomerName" class="form-control-custom" placeholder="Adınız soyadınız" required maxlength="100" />
                    </div>
                    <div class="col-md-6 mb-3">
                        <label class="form-label-custom">Puanınız *</label>
                        <div class="star-rating-input" id="starRating">
                            <i class="fa-regular fa-star star-input" data-value="1"></i>
                            <i class="fa-regular fa-star star-input" data-value="2"></i>
                            <i class="fa-regular fa-star star-input" data-value="3"></i>
                            <i class="fa-regular fa-star star-input" data-value="4"></i>
                            <i class="fa-regular fa-star star-input" data-value="5"></i>
                        </div>
                        <input type="hidden" name="Rating" id="ratingInput" value="0" />
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label-custom">Yorumunuz *</label>
                    <textarea name="Comment" class="form-control-custom" rows="3" placeholder="Deneyiminizi paylaşın..." required maxlength="500"></textarea>
                </div>

                <div style="text-align:center;">
                    <button type="submit" class="btn-accent" style="padding:0.8rem 2rem;" id="submitReview">
                        <i class="fa-solid fa-paper-plane"></i> Yorum Gönder
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<!-- CONTACT -->
<section class="section section-dark" id="iletisim">
    <div class="container">
        <div class="text-center">
            <div class="section-divider"></div>
            <h2 class="section-title reveal">İletişim</h2>
        </div>
        <div class="row g-4 justify-content-center">
            @if (!string.IsNullOrEmpty(Model.Address))
            {
                <div class="col-lg-4 col-md-6">
                    <div class="contact-card reveal">
                        <div class="contact-icon"><i class="fa-solid fa-location-dot"></i></div>
                        <h5>Adres</h5>
                        <p>@Model.Address</p>
                    </div>
                </div>
            }
            @if (!string.IsNullOrEmpty(Model.Phone))
            {
                <div class="col-lg-4 col-md-6">
                    <div class="contact-card reveal">
                        <div class="contact-icon"><i class="fa-solid fa-phone"></i></div>
                        <h5>Telefon</h5>
                        <p>@Model.Phone</p>
                    </div>
                </div>
            }
        </div>
        <div class="text-center mt-5 reveal">
            <a href="/salon/@Model.Slug/randevu" class="btn-accent" style="font-size:1rem; padding:1rem 2.5rem;">
                <i class="fa-solid fa-calendar-check"></i> Hemen Randevu Alın
            </a>
        </div>
    </div>
    </div>
</section>

<!-- FOOTER -->
<footer class="shop-footer">
    <div class="container text-center">
        <p>&copy; @DateTime.Now.Year @Model.Name. Tüm hakları saklıdır.</p>
        <a href="/salon/@Model.Slug/admin" class="admin-link">
            <i class="fa-solid fa-lock"></i> Dükkan Sahibi Girişi
        </a>
    </div>
</footer>

@section Scripts {
    <script>
        // Star rating input
        document.querySelectorAll('.star-input').forEach(star => {
            star.addEventListener('mouseenter', function () {
                const val = parseInt(this.dataset.value);
                highlightStars(val);
            });

            star.addEventListener('click', function () {
                const val = parseInt(this.dataset.value);
                document.getElementById('ratingInput').value = val;
                setStars(val);
            });
        });

        document.getElementById('starRating').addEventListener('mouseleave', function () {
            const current = parseInt(document.getElementById('ratingInput').value);
            setStars(current);
        });

        function highlightStars(count) {
            document.querySelectorAll('.star-input').forEach(s => {
                const v = parseInt(s.dataset.value);
                s.className = v <= count ? 'fa-solid fa-star star-input' : 'fa-regular fa-star star-input';
            });
        }

        function setStars(count) {
            document.querySelectorAll('.star-input').forEach(s => {
                const v = parseInt(s.dataset.value);
                s.className = v <= count ? 'fa-solid fa-star star-input active' : 'fa-regular fa-star star-input';
            });
        }

        document.getElementById('reviewForm').addEventListener('submit', function (e) {
            const rating = parseInt(document.getElementById('ratingInput').value);
            if (rating < 1 || rating > 5) {
                e.preventDefault();
                alert('Lütfen 1-5 arası puan verin.');
            }
        });
    </script>
}
